<!-- runner.html:
	Metaheuristic runner for testing Inveniemus.

	@author <a href="mailto:leonardo.val@creatartis.com">Leonardo Val</a>
	@licence MIT Licence
-->
<html><head>
	<title>Inveniemus runner.</title>
	<meta charset="UTF-8"/>
	<link rel="stylesheet" type="text/css" href="runner.css"/>
	<script type="text/javascript" src="lib/require.js"></script>
	<script type="text/javascript" src="lib/jquery.js"></script>
	<script type="text/javascript" src="lib/dygraph.js"></script>
</head><body onload="main();">
<h3>Inveniemus runner.</h3> 
<div id="header">
	<textarea id="code"></textarea><br/>
	<button id="run">Run</button> - Examples: 
	<button id="exampleRandom">Random search</button>
	<button id="exampleHillClimbing">Hill climbing</button>
	<button id="exampleGeneticAlgorithm">Genetic algorithm</button>
	<button id="exampleBeamSearch">Beam search</button>
</div>
<div id="chart"></div>
<div id="chart_legend"></div>
<script type="text/javascript">
function main() {
	require.config({
		paths: { basis: 'lib/basis', inveniemus: '../inveniemus' }
	})
	require(['basis', 'inveniemus'], function (basis, inveniemus) {
		window.basis = basis;
		window.inveniemus = inveniemus;
	// Set up log.
		basis.Logger.ROOT.appendToConsole();
	// Set up graphs.
		window.evaluationGraph = new Dygraph(document.getElementById("chart"), [], {
			labels: ['step', 'minimum', 'average', 'maximum'],
			colors: ['red', 'black', 'blue'],
			width: $(window).width() * 0.9,
			drawPoints: true,
			customBars: true,
			showRoller: false,
			showRangeSelector: true, rangeSelectorHeight: 30,
			labelsDiv: "chart_legend", legend: "always"
		});
	// Example buttons.
		$('#exampleRandom').click(function () {
			$('#code').val((''+ function () {
				return new inveniemus.Metaheuristic({ 
					problem: new inveniemus.problems.SumOptimization(),
					size: 100, 
					steps: 100
				});
			}).replace(/\t{3}/g, ''));
		});
		$('#exampleHillClimbing').click(function () {
			$('#code').val((''+ function () {
				return new inveniemus.metaheuristics.HillClimbing({
					problem: new inveniemus.problems.SumOptimization(),
					delta: 0.1,
					steps: 100, 
				});
			}).replace(/\t{3}/g, ''));
		});
		$('#exampleGeneticAlgorithm').click(function () {
			$('#code').val((''+ function () {
				return new inveniemus.metaheuristics.GeneticAlgorithm({ 
					problem: new inveniemus.problems.SumOptimization(),
					mutationRate: 0.4,
					size: 100, 
					steps: 50
				});
			}).replace(/\t{3}/g, ''));
		});
		$('#exampleBeamSearch').click(function () {
			$('#code').val((''+ function () {
				return new inveniemus.metaheuristics.BeamSearch({ 
					problem: new inveniemus.problems.SumOptimization(),
					size: 20,
					steps: 50
				});
			}).replace(/\t{3}/g, ''));
		});
	// Run button.
		$('#run').click(function () {
			var graphData = [],
				metaheuristic = eval('('+ $('#code').val() +')()'),
				runMinimum = Infinity,
				runMaximum = -Infinity;
			metaheuristic.events.on('advanced', function () {
				// Update evaluationGraph data with the run statistics.
				var evaluationStats = metaheuristic.statistics.stat({key:'evaluation', step: metaheuristic.step}),
					minimum = evaluationStats.minimum(),
					maximum = evaluationStats.maximum();
				graphData.push([
					metaheuristic.step, 
					[null, minimum, null],
					[minimum, evaluationStats.average(), maximum],
					[null, maximum, null]
				]);
				runMinimum = Math.min(runMinimum, minimum - Math.abs(minimum) * 0.1);
				runMaximum = Math.max(runMaximum, maximum + Math.abs(maximum) * 0.1);
				evaluationGraph.updateOptions({ 
					file: graphData,
					valueRange: [runMinimum, runMaximum]
				});
			});
			return metaheuristic.run().then(function (best) {
				return console.log(best);
			});
		}); // run button click
	}); // require
} // main	
</script>
</body></html>