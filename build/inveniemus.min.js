//! inveniemus 0.1.1

"use strict";!function(a){"function"==typeof define&&define.amd?define(["basis"],a):"object"==typeof module&&module.exports?module.exports=a(require("basis")):(0,eval)("this").inveniemus=a(global.basis)}(function a(b){var c=b.declare,d=b.iterable,e={__init__:a};e.__init__.dependencies=[b];var f=e.Element=c({constructor:function(a,b){this.values="undefined"==typeof a?this.randomValues():a.slice(),this.evaluation=+b},length:10,minimumValue:0,maximumValue:1,random:b.Randomness.DEFAULT,randomValue:function(){return this.random.random(this.minimumValue,this.maximumValue)},randomValues:function(){for(var a=new Array(this.length),b=this.minimumValue,c=this.maximumValue-this.minimumValue,d=0;d<this.length;d++)a[d]=this.random.random()*c+b;return a},evaluate:function(){return this.evaluation=d(this.values).sum()},suffices:function(){return 0===d(this.values).sum()},mapping:function(){return this.values},emblem:function(){return JSON.stringify(this.mapping())},resolution:1/Math.pow(2,52),hammingDistance:function(a,b){return d(a).zip(b).filter(function(a){return a[0]!=a[1]}).count()},manhattanDistance:function(a,b){return d(a).zip(b).map(function(a){return Math.abs(a[0]-a[1])}).sum()},euclideanDistance:function(a,b){return Math.sqrt(d(a).zip(b).map(function(a){return Math.pow(a[0]-a[1],2)}).sum())},rootMeanSquaredError:function(a,b){var c=0,e=d(b).map(function(b){return c++,Math.pow(b[0]-a.apply(this,b.slice(1)),2)}).sum();return 0==c?0:Math.sqrt(e/c)},successors:function(){return this.neighbourhood()},neighbourhood:function(a){a=isNaN(a)?(this.maximumValue-this.minimumValue)/100:+a;var b,c,d=[],e=this.values;for(b=0;b<e.length;b++)c=e[b]+a,c<=this.maximumValue&&d.push(this.modification(b,c)),c=e[b]-a,c>=this.minimumValue&&d.push(this.modification(b,c));return d},modification:function(){var a,c,d=new this.constructor(this.values);for(a=0;a<arguments.length;a+=2)c=+arguments[a+1],b.raiseIf(isNaN(c)||c<this.minimumValue||c>this.maximumValue,"Invalid value ",c," for element."),d.values[0|arguments[a]]=+arguments[a+1];return d},arrayMapping:function(){var a=arguments,c=a[a.length-1];return b.raiseIf(a.length<1,"Element.arrayMapping() expects at least one argument."),this.values.map(function(b,d){var e=a.length>d?a[d]:c;return e[b*e.length|0]})},setMapping:function(a){return b.raiseIf(!Array.isArray(a),"Element.setMapping() expects an array argument."),a=a.slice(),this.values.map(function(b){return a.splice(b*a.length|0,1)[0]})},clone:function(){return new this.constructor(this.values,this.evaluation)},equals:function(a){if(this.constructor===a.constructor&&this.values.length===a.values.length){for(var b=0,c=this.values.length;c>b;b++)if(this.values[b]!==a.values[b])return!1;return!0}return!1},toString:function(){return(this.constructor.name||"Element")+"("+JSON.stringify(this.values)+", "+this.evaluation+")"}}),g=e.Problem=b.declare({title:"<no title>",description:"<no description>",random:b.Randomness.DEFAULT,constructor:function(a){b.initialize(this,a).string("title",{coerce:!0,ignore:!0}).string("description",{coerce:!0,ignore:!0}).object("random",{ignore:!0}).func("representation",{ignore:!0}).func("compare",{ignore:!0}).func("suffices",{ignore:!0})},representation:f,compare:function(a,b){return this.minimization(a,b)},suffices:function(a){return a[0].suffices()},maximization:function(a,b){var c=b.evaluation-a.evaluation;return isNaN(c)?-1/0:Math.abs(c)<a.resolution?0:c},minimization:function(a,b){var c=a.evaluation-b.evaluation;return isNaN(c)?1/0:Math.abs(c)<a.resolution?0:c},approximation:function(a,b,c){var d=Math.abs(b.evaluation-a)-Math.abs(c.evaluation-a);return isNaN(d)?1/0:Math.abs(d)<b.resolution?0:d},toString:function(){return(this.constructor.name||"Problem")+"("+JSON.stringify(this)+")"}}),h=e.problems={},j=e.Metaheuristic=b.declare({logger:new b.Logger("inveniemus",b.Logger.ROOT,"INFO"),constructor:function(a){b.initialize(this,a).object("problem",{defaultValue:null}).number("size",{defaultValue:100,coerce:!0}).array("state",{defaultValue:[]}).number("steps",{defaultValue:100,coerce:!0}).integer("step",{defaultValue:-1,coerce:!0}).object("random",{defaultValue:b.Randomness.DEFAULT}).object("statistics",{defaultValue:new b.Statistics}).object("logger",{ignore:!0}),this.events=new b.Events({events:["initiated","updated","expanded","evaluated","sieved","advanced","analyzed","finished"]})},initiate:function(a){a=isNaN(a)?this.size:+a>>0,this.state=new Array(a);for(var b=0;a>b;b++)this.state[b]=new this.problem.representation;this.events.emit("initiated",this),this.logger&&this.logger.debug("State has been initiated. Nos coepimus.")},update:function(){var a=this;return this.expand(),this.evaluate().then(function(){return a.sieve(),a.events.emit("updated",this),a})},expand:function(a){if(a=a||this.expansion(),a.length<1)this.logger&&this.logger.warn("Expansion is empty");else{var b=this.state.concat(a),c=b.length;b=b.filter(function(a,d){for(d++;c>d;d++)if(a.equals(b[d]))return!1;return!0}),this.state=b}this.events.emit("expanded",this),this.logger&&this.logger.debug("State has been expanded. Nos exploramus.")},expansion:function(a){var b=isNaN(this.expansionRate)?.5:+this.expansionRate;a=isNaN(a)?Math.floor(b*this.size):+a;var c,d=new Array(a);for(c=0;a>c;c++)d[c]=new this.problem.representation;return d},evaluate:function(a){var c=this,e=this.statistics.stat({key:"evaluation_time"});return e.startTime(),a=a||this.state,b.Future.all(d(a).filter(function(a){return isNaN(a.evaluation)},function(a){return b.Future.when(a.evaluate())})).then(function(b){return a.sort(c.problem.compare.bind(c.problem)),e.addTime(),c.events.emit("evaluated",this),c.logger&&c.logger.debug("Evaluated and sorted ",b.length," elements. Appretiatus sunt."),a})},sieve:function(a){a=isNaN(a)?this.size:0|a,this.state.length>a&&(this.state=this.state.slice(0,this.size)),this.events.emit("sieved",this),this.logger&&this.logger.debug("State has been sieved. Viam selectus est.")},finished:function(){return this.step>=this.steps||this.problem.suffices(this.state)?(this.events.emit("finished",this),!0):!1},analyze:function(){var a=this.statistics.stat({key:"evaluation",step:this.step});return this.state.forEach(function(b){a.add(b.evaluation,b)}),this.events.emit("analyzed",this),a},advance:function(){var a,b=this,c=this.statistics.stat({key:"step_time"});return isNaN(this.step)||+this.step<0?(this.statistics.reset(),c.startTime(),this.initiate(),a=this.evaluate()):(c.startTime(),a=this.update()),a.then(function(){return b.step=isNaN(b.step)||+b.step<0?0:+b.step+1,b.analyze(),c.addTime(),b.events.emit("advanced",this),b.logger&&b.logger.info("Step ",b.step," has been completed. Nos proficimus."),b})},run:function(){function a(){return!c.finished()}var c=this,d=this.advance.bind(this);return b.Future.doWhile(d,a).then(function(){return c.logger&&c.logger.info("Finished. Nos invenerunt!"),c.state[0]})},reset:function(){this.step=-1,this.statistics.reset()},toString:function(){return(this.constructor.name||"Metaheuristic")+"("+JSON.stringify(this)+")"}}),k=e.metaheuristics={},l=(k.HillClimbing=b.declare(j,{constructor:function(a){j.call(this,a),b.initialize(this,a).number("delta",{defaultValue:.01,coerce:!0}).integer("size",{defaultValue:1,coerce:!0})},update:function(){var a=this,c=0;return b.Future.all(this.state.map(function(b){var d=b.neighbourhood(a.delta);return d.push(b),a.evaluate(d).then(function(a){var d=a[0];return b===d&&c++,d})})).then(function(b){a.state=b,a.__localOptima__=c})},atLocalOptima:function(){return this.__localOptima__>=this.state.length},finished:function(){return j.prototype.finished.call(this)||this.atLocalOptima()},toString:function(){return(this.constructor.name||"HillClimbing")+"("+JSON.stringify(this)+")"}}),k.GeneticAlgorithm=b.declare(j,{constructor:function m(a){j.call(this,a),b.initialize(this,a).number("expansionRate",{defaultValue:.5,minimum:0,coerce:!0}).number("mutationRate",{defaultValue:.2,minimum:0,maximum:1,coerce:!0}).func("selection",{defaultValue:m.selections.rankSelection}).func("crossover",{defaultValue:m.crossovers.singlepointCrossover}).func("mutation",{defaultValue:m.mutations.singlepointUniformMutation})},expansion:function(){var a,b,c,d=[],e=Math.floor(this.expansionRate*this.size);e+=e%2;for(var f=0;e>f;f+=2){a=this.selection(),b=this.crossover(a);for(var g=0;g<b.length;g++)c=this.random.randomBool(this.mutationRate)?this.mutation(b[g]):b[g],d.push(c)}return d},toString:function(){return(this.constructor.name||"GeneticAlgorithm")+"("+JSON.stringify(this)+")"}}));l.selections={rankSelection:function(a){a=isNaN(a)?2:+a;var b=this.state.length,c=this.random.randoms(a,0,b*(b+1)/2-1),d=[];return c.sort(function(a,b){return a-b}),this.state.forEach(function(e){for(var f=0;a>f;f++)c[f]+=f-b;c[0]<=0&&(d.push(e),c.shift())}),d.length<a&&(d=d.concat(this.state.slice(0,a-d.length))),d},rouletteSelection:function(a){a=isNaN(a)?2:+a;var b=this.state.length,c=this.statistics.stat({key:"evaluation",step:this.step}),d=c.minimum(),e=c.sum(),f=this.random.randoms(a,0,e-b*d),g=[];return f.sort(function(a,b){return a-b}),this.state.forEach(function(c){for(var d=0;a>d;d++)f[d]+=d-b;f[0]<=0&&(g.push(c),f.shift())}),g.length<a&&(g=g.concat(this.state.slice(0,a-g.length))),g}},l.crossovers={singlepointCrossover:function(a){b.raiseIf(!Array.isArray(a)||a.length<2,"A two parent array is required.");var c=this.random.randomInt(this.length-1)+1,d=a[0].values,e=a[1].values,f=this.problem.representation;return[new f(d.slice(0,c).concat(e.slice(c))),new f(e.slice(0,c).concat(d.slice(c)))]}},l.mutations={singlepointUniformMutation:function(a){return a.modification(this.random.randomInt(a.length),a.randomValue())},uniformMutation:function(a){return max=isNaN(a)?1/0:+a,function(b){var c=a;b=new b.constructor(b.values);do b.values[this.random.randomInt(b.length)]=b.randomValue();while(this.random.randomBool(this.mutationRate)&&--c>0);return b}},singlepointBiasedMutation:function(a){return a.modification(this.random.randomInt(a.length),Math.max(a.minimumValue,Math.min(a.maximumValue,a.values[i]+this.random.random()-this.random.random())))}};k.BeamSearch=b.declare(j,{constructor:function(a){j.call(this,a)},successors:function(a){return a.successors()},expansion:function(){var a=[],b=this.successors.bind(this);return this.state.forEach(function(c){a=a.concat(b(c))}),a},toString:function(){return(this.constructor.name||"BeamSearch")+"("+JSON.stringify(this)+")"}}),k.SimulatedAnnealing=b.declare(j,{constructor:function(a){j.call(this,a),b.initialize(this,a).number("maximumTemperature",{defaultValue:1,coerce:!0}).number("minimumTemperature",{defaultValue:0,coerce:!0}).number("delta",{defaultValue:.01,coerce:!0}).integer("size",{defaultValue:1,coerce:!0})},randomNeighbour:function(a,b){b=isNaN(b)?this.delta:+b;var c=this.random.randomInt(a.values.length),d=a.values[c];return d=this.random.randomBool()?Math.min(a.maximumValue,d+b):Math.max(a.minimumValue,d-b),a.modification(c,d)},acceptance:function(a,b,c){if(c=isNaN(c)?this.temperature():+c,this.problem.compare(a,b)>0)return 1;var d=-Math.abs(b.evaluation-a.evaluation);return Math.min(1,Math.exp(d/c))},temperature:function(){return(1-Math.max(0,this.step)/this.steps)*(this.maximumTemperature-this.minimumTemperature)+this.minimumTemperature},update:function(){var a=this,c=this.temperature(),d=this.statistics.stat({key:"acceptance"}),e=this.statistics.stat({key:"temperature"});return e.add(c,this.step),b.Future.all(this.state.map(function(e){var f=a.randomNeighbour(e);return b.Future.when(f.evaluate()).then(function(){var b=a.acceptance(e,f,c);return d.add(b,f),a.random.randomBool(b)?f:e})})).then(function(b){return a.state=b})},toString:function(){return(this.constructor.name||"SimulatedAnnealing")+"("+JSON.stringify(this)+")"}});return h.SumOptimization=b.declare(g,{title:"Sum optimization",description:"Very simple problem based on optimizing the elements' values sum.",constructor:function(a){g.call(this,a),b.initialize(this,a).number("target",{coerce:!0,defaultValue:-1/0})},representation:b.declare(f,{evaluate:function(){return this.evaluation=d(this.values).sum()}}),suffices:function(a){return d(a[0].values).sum()===this.target},compare:function(a,b){return this.target===-1/0?this.minimization(a,b):1/0===this.target?this.maximization(a,b):this.approximation(this.target,a,b)}}),h.HelloWorld=b.declare(g,{title:"Hello world",description:"Simple problem where each element is a string, and the optimization goes towards the target string.",constructor:function(a){g.call(this,a),b.initialize(this,a).string("target",{coerce:!0,defaultValue:"Hello world!"});var c=this.target,e=d(c).map(function(a){return a.charCodeAt(0)}).toArray();this.representation=b.declare(f,{length:c.length,minimumValue:32,maximumValue:254,suffices:function(){return this.mapping()===c},evaluate:function(){return this.evaluation=this.manhattanDistance(e,this.values)},mapping:function(){return d(this.values).map(function(a){return String.fromCharCode(0|a)}).join("")}})},compare:g.prototype.minimization}),h.NQueensPuzzle=b.declare(g,{title:"N-queens puzzle",description:"Generalized version of the classic problem of placing 8 chess queens on an 8x8 chessboard so that no two queens attack each other.",constructor:function(a){g.call(this,a),b.initialize(this,a).integer("N",{coerce:!0,defaultValue:8});var c=b.Iterable.range(this.N).toArray();this.representation=b.declare(f,{length:this.N,suffices:function(){return 0===this.evaluation},evaluate:function(){var a=this.mapping(),b=0;return a.forEach(function(c,d){for(var e=1;d+e<a.length;e++)(a[e]==c+e||a[e]==c-e)&&b++}),this.evaluation=b},mapping:function(){return this.setMapping(c)}})},compare:g.prototype.minimization}),h.KnapsackProblem=b.declare(g,{title:"Knapsack problem",description:"Given a set of items with a cost and a worth, select a subset  maximizing the worth sum but not exceeding a cost limit.",items:{itemA:{cost:12,worth:4},itemB:{cost:2,worth:2},itemC:{cost:1,worth:2},itemD:{cost:1,worth:1},itemE:{cost:4,worth:10}},constructor:function(a){g.call(this,a),b.initialize(this,a).number("limit",{coerce:!0,defaultValue:15}).integer("amount",{coerce:!0,defaultValue:1,minimum:1}).object("items",{ignore:!0});var c=this;this.representation=b.declare(f,{length:Object.keys(this.items).length,evaluate:function(){var a=this.mapping(),b=0,d=0;return Object.keys(a).forEach(function(e){var f=c.items[e],g=a[e];b+=f.worth*g,d+=f.cost*g}),this.evaluation=d>c.limit?-b:b},mapping:function(){var a={},b=Object.keys(c.items);return b.sort(),d(this.values).zip(b).forEach(function(b){var d=c.items[b[1]],e=b[0]*(1+(+d.amount||1))|0;a[b[1]]=e}),a}})},compare:g.prototype.maximization}),e});
//# sourceMappingURL=inveniemus.min.js.map