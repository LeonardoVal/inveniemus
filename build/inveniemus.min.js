//! inveniemus 0.2.0

(function(t){"use strict";"function"==typeof define&&define.amd?define(["creatartis-base","sermat"],t):"object"==typeof exports&&module.exports?module.exports=t(require("creatartis-base"),require("sermat")):this.inveniemus=t(this.base,this.Sermat)}).call(this,function t(e,n){"use strict";var i=e.declare,a=e.iterable,r=e.initialize,o=e.raise,s=e.raiseIf,u=e.Events,l=e.Future,c=e.Iterable,m=e.Logger,h=e.Randomness,f=e.Statistics,p={__package__:"inveniemus",__name__:"inveniemus",__init__:t,__dependencies__:[e],__SERMAT__:{include:[]}},_=p.metaheuristics={},d=p.problems={},v=p.utilities={},g=v.clamp=function(t,e,n){return Math.max(e,Math.min(n,t))};v.emblemHan=function(t){return"[Element "+(t.evaluation?t.evaluation.map(function(t){return isNaN(t)?"?":Math.round(1e6*+t)/1e6}).join(","):"?")+" "+b(t.values())+"]"},v.encodeHan=function(t){return t.map(function(t){return s((t|=0)>21009,"Values like ",t," > ",21009," cannot be encoded!"),s(t<-11172,"Values like ",t," < ",-11172," cannot be encoded!"),String.fromCharCode(t+(t>=0?19904:55204))}).join("")},v.decodeHan=function(t){return t.split("").map(function(t){var e=t.charCodeAt(0);return e>=19904&&e<=40912?e-19904:e>=44032&&e<=55203?e-55203-1:void o("Cannot decode character '"+t+"'!")})};var b=v.encodeHan,M=p.Element=i({constructor:function(t,e){this.__values__=t?this.checkValues(t,!1):this.randomValues(),this.evaluation=e},"property evaluation":{get:function(){return this.__evaluation__},set:function(t){Array.isArray(t)||!isNaN(t)&&null!==t?this.__evaluation__=(Array.isArray(t)?t:[t]).map(function(t){return+t}):this.__evaluation__=null}},ArrayType:Uint32Array,values:function(){return Array.prototype.slice.call(this.__values__)},model:c.repeat({n:128},10).toArray(),randomValue:function(t){return 0|this.problem.random.randomInt(0,this.model[t].n)},randomValues:function(){var t=this.problem.random;return new this.ArrayType(this.model.map(function(e){return 0|t.randomInt(0,e.n)}))},checkValues:function(t,e){return new this.ArrayType(this.model.map(function(n,i){var a=t[i],r=n.n;return isNaN(a)?(s(!e,"Value #",i," (",a,") is NaN!"),0):a<0||a>=r?(s(!e,"Value #",i," (",a,") is out of range [0,",r-1,"]!"),a<0?0:r-1):a}))},suffices:function(){return this.problem.sufficientElement(this)},emblem:function(){return"[Element "+this.evaluation+" "+this.values().join(",")+"]"},evaluate:function(){var t=this;return l.then(this.problem.evaluation(this),function(e){return t.evaluation=e,s(null===t.evaluation,"The evaluation of ",t," is null!"),t.evaluation})},hammingDistance:function(t,e){for(var n=0,i=0,a=Math.min(t.length,e.length);i<a;i++)t[i]!==e[i]&&n++;return n},manhattanDistance:function(t,e){for(var n=0,i=0,a=Math.min(t.length,e.length);i<a;i++)n+=Math.abs(t[i]-e[i]);return n},euclideanDistance:function(t,e){for(var n=0,i=0,a=Math.min(t.length,e.length);i<a;i++)n+=Math.pow(t[i]-e[i],2);return Math.sqrt(n)},rootMeanSquaredError:function(t,e){var n=0,i=a(e).map(function(e){return n++,Math.pow(e[0]-t.apply(this,e.slice(1)),2)}).sum();return 0===n?0:Math.sqrt(i/n)},isBetterThan:function(t){return this.problem.compare(this,t)>0},neighbourhood:function(t){var e,n,i=[],a=this.model,r=this.__values__,o=Math.abs(Array.isArray(t)?t[s]:t);isNaN(o)&&(o=1);for(var s=0,u=r.length;s<u;s++)n=r[s],e=a[s].n,n>0&&i.push(this.modification(s,Math.max(0,n-o))),n<e-1&&i.push(this.modification(s,Math.min(e-1,n+o)));return i},modification:function(){for(var t=this.__values__.slice(),e=0;e<arguments.length;e+=2)t[0|arguments[e]]=g(arguments[e+1],0,this.model[e].n-1);return new this.constructor(t)},mapping:function(){return this.problem.mapping(this)},rangeMapping:function(){var t=arguments,e=this.model,n=t[t.length-1];return s(t.length<1,"Element.rangeMapping() expects at least one argument!"),Array.prototype.map.call(this.__values__,function(i,a){var r=e[a].n,o=t.length>a?t[a]:n;return i=i/r*(o[1]-o[0])+o[0],g(i,o[0],o[1])})},normalizedValues:function(){return this.rangeMapping([0,1])},arrayMapping:function(){var t=arguments,e=t[t.length-1],n=this.model;return s(t.length<1,"Element.arrayMapping() expects at least one argument!"),Array.prototype.map.call(this.__values__,function(i,a){var r=t.length>a?t[a]:e,o=n[a].n;return r[Math.floor(i/o*r.length)]})},setMapping:function(t,e){s(!Array.isArray(t),"Element.setMapping() expects an array argument!"),t=t.slice();var n=this.normalizedValues().map(function(e,n){s(t.length<1,"Element.setMapping(): insufficient elements!");var i=g(Math.floor(e*t.length),0,t.length-1);return t.splice(i,1)[0]});return e&&(s(1!=t.length,"Element.setMapping(): wrong amount of elements!"),n.push(t[0])),n},clone:function(){return new this.constructor(this.__values__,this.evaluation)},equals:function(t){if(this.constructor===t.constructor&&this.__values__.length===t.__values__.length){for(var e=0,n=this.__values__.length;e<n;e++)if(this.__values__[e]!==t.__values__[e])return!1;return!0}return!1},toString:function(){return n.ser(this)},"static __SERMAT__":{identifier:"Element",serializer:function(t){return[t.problem,t.values(),t.evaluation]},materializer:function(t,e){return e?new e[0].Element(e[1],e[2]):null}}}),y=p.Problem=i({constructor:function(t){r(this,t=t||{}).string("title",{ignore:!0,coerce:!0}).string("description",{ignore:!0,coerce:!0}).object("random",{ignore:!0}).array("objectives",{ignore:!0}).array("elementModel",{ignore:!0}).func("Element",{ignore:!0}),isNaN(t.objective)||(this.objectives=[t.objective]),this.Element=i(this.Element||M,{problem:this}),t.elementModel&&(this.Element.prototype.model=t.elementModel)},title:"Problem.title?",description:"Problem.description?",random:h.DEFAULT,objectives:[-1/0],evaluation:function(t){return a(t.values()).sum()},evaluate:function(t,e){var n=!1;return t=a(t).filter(function(t){return e||null===t.evaluation},function(t){var e=t.evaluate();return n=n||l.__isFuture__(e),e}).toArray(),n?l.all(t):t},mapping:function(t){return t.normalizedValues()},sufficientElement:function(t){return!1},sufficientElements:function(t){return this.sufficientElement(t[0])},compare:function(t,e){return 1===this.objectives.length?this.singleObjectiveComparison(this.objectives[0],t.evaluation[0],e.evaluation[0]):this.paretoComparison(this.objectives,t.evaluation,e.evaluation)},singleObjectiveComparison:function(t,e,n){var i;switch(t){case-1/0:return i=n-e,isNaN(i)?1/0:i;case 1/0:return i=e-n,isNaN(i)?-1/0:i;default:return i=Math.abs(n-t)-Math.abs(e-t),isNaN(i)?1/0:i}},paretoComparison:function(t,e,n){var i,a=0,r=0,o=this;return s(t.length!==e.length,"Expected ",t.length," evaluations, but got ",e.length,"!"),s(t.length!==n.length,"Expected ",t.length," evaluations, but got ",n.length,"!"),(i=c.zip(t,e,n).mapApply(function(t,e,n){var i=o.singleObjectiveComparison(t,e,n);return i<0?a++:i>0&&r++,i}).toArray()).domination=0===a?r:0===r?-a:NaN,i},__params__:function(){var t={},e=this;return(arguments.length>0?Array.prototype.slice.call(arguments):["title","description","random","objectives","elementModel"]).forEach(function(n){void 0!==e[n]&&(t[n]=e[n])}),t},toString:function(){return n.ser(this)},"static __SERMAT__":{identifier:"Problem",serializer:function(t){return[t.__params__()]}}}),N=p.Metaheuristic=i({logger:new m("inveniemus",m.ROOT,"INFO"),constructor:function(t){r(this,t).object("problem",{defaultValue:null}).number("size",{defaultValue:100,coerce:!0}).array("state",{defaultValue:[]}).number("steps",{defaultValue:100,coerce:!0}).integer("step",{defaultValue:-1,coerce:!0}).object("random",{defaultValue:h.DEFAULT}).object("statistics",{defaultValue:new f}).object("logger",{ignore:!0}),this.events=new u({events:["initiated","updated","expanded","evaluated","sieved","advanced","analyzed","finished"]})},__log__:function(t){this.logger&&this.logger[t].apply(this.logger,arguments)},initiate:function(t){t=isNaN(t)?this.size:+t||0,this.state=new Array(t);for(var e=0;e<t;e++)this.state[e]=new this.problem.Element;this.onInitiate()},update:function(){var t=this;return this.expand(),l.then(this.evaluate(),function(){return t.sieve(),t.onUpdate(),t})},expand:function(t){(t=t||this.expansion()).length<1?this.__log__("warn","Expansion is empty"):this.state=this.state.concat(t),this.onExpand()},expansion:function(t){var e=isNaN(this.expansionRate)?1:+this.expansionRate;t=isNaN(t)?Math.floor(e*this.size):+t;var n,i=new Array(t);for(n=0;n<t;n++)i[n]=new this.problem.Element;return i},evaluate:function(t){var e=this,n=this.statistics&&this.statistics.stat({key:"evaluation_time"});return n&&n.startTime(),t=t||this.state,l.then(this.problem.evaluate(t),function(i){return t=e.sort(t),n&&n.addTime(),e.onEvaluate(i),t})},sort:function(t){return t=t||this.state,this.problem.objectives.length>1?t=this.multiObjectiveSort(t):(t.sort(this.problem.compare.bind(this.problem)),t.reverse()),t},sieve:function(t){t=isNaN(t)?this.size:Math.floor(t),this.state.length>t&&(this.state=this.state.slice(0,this.size)),this.onSieve()},finished:function(){return this.step>=this.steps||this.problem.sufficientElements(this.state)},analyze:function(t){t=t||this.statistics;var e=this.step;if(t){if(1===this.state[0].evaluation.length){var n=t.stat({key:"evaluation",step:e});this.state.forEach(function(t){t.evaluation&&n.add(t.evaluation[0],t)})}else{var i=this.state[0].evaluation.map(function(n,i){return t.stat({key:"evaluation",index:i,step:e})}),a=t.stat({key:"dominators",step:e}),r=t.stat({key:"dominated",step:e});this.state.forEach(function(t){t.evaluation.forEach(function(e,n){i[n].add(e,t)}),a.add(t.pareto.dominators.length,t),r.add(t.pareto.dominated.length,t)})}this.onAnalyze()}return t},advance:function(){var t,e=this,n=this.statistics&&this.statistics.stat({key:"step_time"});return isNaN(this.step)||+this.step<0?(this.reset(),n&&n.startTime(),this.initiate(),t=this.evaluate()):(n&&n.startTime(),t=this.update()),l.then(t,function(){return e.step=isNaN(e.step)||+e.step<0?0:+e.step+1,e.analyze(),n&&n.addTime(),e.onAdvance(),e})},run:function(){var t=this,e=this.advance.bind(this);return l.doWhile(e,function(){return!t.finished()}).then(function(){return t.onFinish(),t.state[0]})},reset:function(){this.step=-1,this.statistics&&this.statistics.reset()},nub:function(t){return t=+t||0,this.state=a(this.state).nub(function(e,n){var i=e.__values__,a=n.__values__,r=i.length;if(r!==a.length)return!1;for(var o=0;o<r;++o)if(Math.abs(i[o]-a[o])>t)return!1;return!0}).toArray(),this.state.length},onInitiate:function(){this.events.emit("initiated",this),this.__log__("debug","State has been initiated. Nos coepimus.")},onUpdate:function(){this.events.emit("updated",this),this.__log__("debug","State has been updated. Mutatis mutandis.")},onExpand:function(){this.events.emit("expanded",this),this.__log__("debug","State has been expanded. Nos exploramus.")},onEvaluate:function(t){this.events.emit("evaluated",this,t),this.__log__("debug","Evaluated and sorted ",t.length," elements. Appretiatus sunt.")},onSieve:function(){this.events.emit("sieved",this),this.__log__("debug","State has been sieved. Haec est viam.")},onAdvance:function(){this.events.emit("advanced",this),this.__log__("debug","Step ",this.step," has been completed. Nos proficimus.")},onAnalyze:function(){this.events.emit("analyzed",this),this.__log__("debug","Statistics have been gathered. Haec sunt numeri.")},onFinish:function(){this.events.emit("finished",this),this.__log__("debug","Finished. Nos invenerunt!")},paretoAnalysis:function(t){var e,n,i,a,r,o=(t=t||this.state).length;for(e=0;e<o;e++)t[e].pareto={dominated:[],dominators:[]};for(e=0;e<o;e++)for(i=t[e],n=e+1;n<o;n++)a=t[n],(r=this.problem.compare(i,a).domination)>0?(i.pareto.dominated.push(a),a.pareto.dominators.push(i)):r<0&&(a.pareto.dominated.push(i),i.pareto.dominators.push(a));return t},multiObjectiveSort:function(t){return this.nonDominatedSort(t)},crowdingDistance:function(t){var e,n,i=(t=t||this.state).slice(),a=this.problem.objectives.length;for(e=0;e<i.length;e++)i[e].crowdingDistance=0;for(e=0;e<a;e++)for(i.sort(function(t,n){return t.evaluation[e]-n.evaluation[e]}),i[0].crowdingDistance=1/0,i[i.length-1].crowdingDistance=1/0,n=1;n<i.length-1;n++)i[n].crowdingDistance+=i[n+1].evaluation[e]-i[n-1].evaluation[e];return t},nonDominatedSort:function(t){return t=this.paretoAnalysis(t),(t=this.crowdingDistance(t)).sort(function(t,e){return t.pareto.dominators.length-e.pareto.dominators.length||e.crowdingDistance-t.crowdingDistance}),t},strengthParetoSort:function(t){return t=this.paretoAnalysis(t),a(t).forEach(function(t){t.pareto.strength=a(t.pareto.dominators).map(function(t){return t.pareto.dominated.length}).sum()}),t.sort(function(t,e){return t.pareto.strength-e.pareto.strength})},toString:function(){return"[object "+(this.constructor.name||"Metaheuristic")+"]"},__params__:function(){var t={problem:this.problem,size:this.size,steps:this.steps};this.random!==h.DEFAULT&&(t.random=this.random),this.step>=0?(t.step=this.step,t.state=this.state,t.statistics=this.statistics):this.state.length>0&&(t.state=this.state);for(var e=0;e<arguments.length;e++){var n=arguments[e];this.hasOwnProperty(n)&&(t[n]=this[n])}return t},"static __SERMAT__":{identifier:"Metaheuristic",serializer:function(t){return[t.__params__()]}}}),E=(_.HillClimbing=i(N,{constructor:function(t){N.call(this,t),r(this,t).number("delta",{defaultValue:1,coerce:!0}).integer("size",{defaultValue:1,coerce:!0})},update:function(){var t=this,e=0;return l.all(this.state.map(function(n){var i=n.neighbourhood(t.delta);return i.push(n),l.then(t.evaluate(i),function(t){var i=t[0];return n===i&&e++,i})})).then(function(n){n=t.sort(n),t.state=n,t.__localOptima__=e,t.onUpdate()})},atLocalOptima:function(){return this.__localOptima__>=this.state.length},finished:function(){return N.prototype.finished.call(this)||this.atLocalOptima()},"static __SERMAT__":{identifier:"HillClimbing",serializer:function(t){return[t.__params__("delta")]}}}),_.GeneticAlgorithm=i(N,{constructor:function t(e){N.call(this,e),r(this,e).number("expansionRate",{defaultValue:.5,minimum:0,coerce:!0}).number("mutationRate",{defaultValue:.2,minimum:0,maximum:1,coerce:!0}).func("selection",{defaultValue:t.selections.rankSelection}).func("crossover",{defaultValue:t.crossovers.singlepointCrossover}).func("mutation",{defaultValue:t.mutations.singlepointUniformMutation})},expansion:function(){var t,e,n,i=[],a=Math.floor(this.expansionRate*this.size);a+=a%2;for(var r=0;r<a;r+=2){t=this.selection(),e=this.crossover(t);for(var o=0;o<e.length;o++)n=this.random.randomBool(this.mutationRate)?this.mutation(e[o]):e[o],i.push(n)}return this.onExpand(),i},"static selections":{rankSelection:function(t){t=isNaN(t)?2:+t;var e=this.state.length,n=this.random.randoms(t,0,e*(e+1)/2-1),i=[];return n.sort(function(t,e){return t-e}),this.state.forEach(function(a){for(var r=0;r<t;r++)n[r]+=r-e;n[0]<=0&&(i.push(a),n.shift())}),i.length<t&&(i=i.concat(this.state.slice(0,t-i.length))),i},rouletteSelection:function(t){t=isNaN(t)?2:0|t;var e=this.state.length,n=this.statistics.stat({key:"evaluation",step:this.step}),i=n.minimum(),a=n.sum(),r=this.random.randoms(t,0,a-e*i),o=[];return r.sort(function(t,e){return t-e}),this.state.forEach(function(n){for(var i=0;i<t;i++)r[i]+=i-e;r[0]<=0&&(o.push(n),r.shift())}),o.length<t&&(o=o.concat(this.state.slice(0,t-o.length))),o},stochasticUniversalSamplingSelection:function(t){t=isNaN(t)?2:0|t;var n=this.state,i=a(n).select("evaluation").sum()/t;return e.Iterable.iterate(function(t){return t+i},this.random.randomInt(i),t).map(function(t){for(var e=0,i=0;i<n.length;++i)if((e+=n[i].evaluation)>=t)return n[i];return n[n.length-1]}).toArray()}},"static crossovers":{singlepointCrossover:function(t){s(!Array.isArray(t)||t.length<2,"A two parent array is required.");var e=this.random.randomInt(this.length-1)+1,n=t[0].values(),i=t[1].values();return[new this.problem.Element(n.slice(0,e).concat(i.slice(e))),new this.problem.Element(i.slice(0,e).concat(n.slice(e)))]},twopointCrossover:function(t){s(!Array.isArray(t)||t.length<2,"A two parent array is required.");var e=this.random.randomInt(this.length-1)+1,n=this.random.randomInt(this.length-1)+1,i=t[0].values(),a=t[1].values();return[new this.problem.Element(i.slice(0,e).concat(a.slice(e,n)).concat(i.slice(n))),new this.problem.Element(a.slice(0,e).concat(i.slice(e,n)).concat(a.slice(n)))]},uniformCrossover:function(t,e){e=isNaN(e)?t.length:0|e;for(var n,i=[],a=this.problem.elementLength(),r=this.random,o=0;o<e;++o){n=[];for(var s=0;s<a;++s)n.push(r.choice(t).values[s]);i.push(new this.problem.Element(n))}return i}},"static mutations":{singlepointUniformMutation:function(t){var e=this.random.randomInt(t.__values__.length);return t.modification(e,t.randomValue(e))},uniformMutation:function(t){max=isNaN(t)?1/0:+t;var e=this.problem.elementModel();return function(n){var i,a=t;n=new this.problem.Element(n.__values__);do{i=this.random.randomInt(e.length),n.values[i]=this.random.randomInt(0,e[i].n)}while(this.random.randomBool(this.mutationRate)&&--a>0);return n}},singlepointBiasedMutation:function(t){var e=this.random,n=this.problem.elementModel(),i=e.randomInt(t.length);return t.modification(i,t.__values__[i]+(e.random()-e.random())*n[i].n)},recombinationMutation:function(t){var e=t.__values__.slice(),n=this.random.randomInt(e.length),i=e[n],a=this.random.randomInt(e.length);return n===a&&(a=(a+1)%t.length),e[n]=e[a],e[a]=i,new this.problem.Element(e)}},"static __SERMAT__":{identifier:"GeneticAlgorithm",serializer:function(t){return[t.__params__("expansionRate","mutationRate")]}}}),_.BeamSearch=i(N,{constructor:function(t){N.call(this,t),r(this,t).number("delta",{ignore:!0,coerce:!0})},successors:function(t){return t.neighbourhood(this.delta)},expansion:function(){var t=[],e=this.successors.bind(this);return this.state.forEach(function(n){t=t.concat(e(n))}),this.onExpand(),t},"static __SERMAT__":{identifier:"BeamSearch",serializer:function(t){return[t.__params__("delta")]}}}),_.SimulatedAnnealing=i(N,{constructor:function(t){N.call(this,t),r(this,t).number("maximumTemperature",{defaultValue:1,coerce:!0}).number("minimumTemperature",{defaultValue:0,coerce:!0}).number("delta",{defaultValue:1,coerce:!0}).integer("size",{defaultValue:1,coerce:!0}).func("temperature",{defaultValue:this.coolingSchedule.linear})},randomNeighbour:function(t,e){e=isNaN(e)?this.delta:+e;var n=this.random.randomInt(t.model.length),i=t.__values__[n];return t.modification(n,g(this.random.randomBool()?i+e:i-e,0,t.model[n].n-1))},acceptance:function(t,e,n){if(n=isNaN(n)?this.temperature():+n,e.isBetterThan(t))return 1;var i=-Math.abs(e.evaluation-t.evaluation);return g(Math.exp(i/n),0,1)},coolingSchedule:{linear:function(){return(1-Math.max(0,this.step)/this.steps)*(this.maximumTemperature-this.minimumTemperature)+this.minimumTemperature}},update:function(){var t=this,e=this.temperature(),n=this.statistics.stat({key:"acceptance"});return this.statistics.stat({key:"temperature"}).add(e,this.step),l.all(this.state.map(function(i){var a=t.randomNeighbour(i);return l.then(a.evaluate(),function(){var r=t.acceptance(i,a,e);return n.add(r,a),t.random.randomBool(r)?a:i})})).then(function(e){return e=t.sort(e),t.state=e,t.onUpdate(),t})},"static __SERMAT__":{identifier:"SimulatedAnnealing",serializer:function(t){return[t.__params__("maximumTemperature","minimumTemperature","delta")]}}}),_.ParticleSwarm=i(N,{constructor:function(t){N.call(this,t),r(this,t).number("inertia",{defaultValue:1,coerce:!0}).number("localAcceleration",{defaultValue:.5,coerce:!0}).number("globalAcceleration",{defaultValue:.3,coerce:!0})},initiate:function(t){N.prototype.initiate.call(this,t);var e=this,n=this.state.forEach(function(t){var n=t.model;t.__velocity__=e.random.randoms(n.length,-1,1).map(function(t,e){return t*n[e].n}),t.__localBest__=t});return this.onInitiate(),n},nextVelocity:function(t,e){var n=this,i=t.__velocity__,a=t.__localBest__,r=this.random.random(this.localAcceleration),o=this.random.random(this.globalAcceleration);return t.values().map(function(t,s){return i[s]*n.inertia+r*(a.__values__[s]-t)+o*(e.__values__[s]-t)})},nextElement:function(t,e){var n=t.model,i=this.nextVelocity(t,e),a=t.values().map(function(t,e){return g(t+i[e],0,n[e].n-1)}),r=new this.problem.Element(a);return l.then(r.evaluate(),function(){return r.__velocity__=i,r.__localBest__=r.isBetterThan(t.__localBest__)?r:t.__localBest__,r})},update:function(){var t=this,e=this.__globalBest__;return e||(e=this.__globalBest__=this.state[0]),l.all(this.state.map(function(n){return t.nextElement(n,e)})).then(function(e){return e=t.sort(e),t.state=e,t.problem.compare(t.__globalBest__,e[0])<0&&(t.__globalBest__=e[0]),t.onUpdate(),t})},"static __SERMAT__":{identifier:"ParticleSwarm",serializer:function(t){return[t.__params__("inertia","localAcceleration","globalAcceleration")]}}}),_.DifferentialEvolution=i(N,{constructor:function(t){N.call(this,t),r(this,t).number("differentialWeight",{coerce:!0,defaultValue:1,minimum:0,maximum:2}).number("crossoverProbability",{coerce:!0,defaultValue:.3,minimum:0,maximum:1}).integer("size",{coerce:!0,defaultValue:100,minimum:4})},expansion:function(){var t=this,e=this.state.map(function(e,n){var i=e.model,a=t.state.slice();a.splice(n,1);var r=t.random.choices(3,a),o=r[0].__values__,s=r[1].__values__,u=r[2].__values__,l=e.__values__.length,c=t.random.randomInt(l),m=e.values().map(function(e,n){return n===c||t.random.randomBool(t.crossoverProbability)?g(o[n]+t.differentialWeight*(s[n]-u[n]),0,i[n].n-1):e});return new t.problem.Element(m)});return this.onExpand(),e},"static __SERMAT__":{identifier:"DifferentialEvolution",serializer:function(t){return[t.__params__("differentialWeight","crossoverProbability")]}}}),_.EvolutionStrategy=i(N,{constructor:function(t){N.call(this,t),r(this,t).number("mutantCount",{coerce:!0,defaultValue:1,minimum:1}).integer("size",{coerce:!0,defaultValue:1,minimum:1})},mutant:function(t){var e=this.random,n=t.model,i=t.values().map(function(t,i){var a=n[i].n;return g(t+(e.random()-e.random())*a,0,a-1)});return new this.problem.Element(i)},mutants:function(t,e){e=isNaN(e)?this.mutantCount:+e;for(var n=[],i=0;i<e;++i)n.push(this.mutant(t));return n},expansion:function(){var t=this,e=[];return this.state.forEach(function(n){e=e.concat(t.mutants(n))}),this.onExpand(),e},"static __SERMAT__":{identifier:"DistributionEstimation",serializer:function(t){return[t.__params__("mutantCount")]}}}),_.HarmonySearch=i(N,{constructor:function(t){N.call(this,t),r(this,t).number("harmonyProbability",{coerce:!0,defaultValue:.9,minimum:0,maximum:1}).number("adjustProbability",{coerce:!0,defaultValue:.5,minimum:0,maximum:1}).number("delta",{coerce:!0,defaultValue:1}).number("fretWidth",{coerce:!0,defaultValue:.01})},expansion:function(){var t=this,e=this.random,n=this.problem.Element.prototype.model.map(function(n,i){if(e.randomBool(t.harmonyProbability)){var a=e.choice(t.state).__values__[i];return e.randomBool(t.adjustProbability)&&(a+=e.randomBool(.5)?-t.delta:t.delta),g(a,0,n.n-1)}return 0|e.randomInt(0,n.n)});return this.onExpand(),[new this.problem.Element(n)]},"static __SERMAT__":{identifier:"HarmonySearch",serializer:function(t){return[t.__params__("harmonyProbability","adjustProbability","delta","fretWidth")]}}}),_.DistributionEstimation=i(N,{constructor:function(t){N.call(this,t),r(this,t).integer("histogramWidth",{coerce:!0,defaultValue:10,minimum:2})},expansion:function(t){var n=this,i=isNaN(this.expansionRate)?.5:+this.expansionRate,a=this.histograms();return t=isNaN(t)?Math.floor(i*this.size):0|t,e.Iterable.repeat(null,t).map(function(){return n.elementFromHistograms(a)}).toArray()},histograms:function(){return E.histograms(this.state,this.histogramWidth,this.problem.Element.prototype.model.length)},"static histograms":function(t,e,n){var i=t.length,a=c.iterate(function(t){return t.slice()},c.repeat(0,e).toArray(),n).toArray();return t.forEach(function(t){t.__values__.forEach(function(t,n){var i=Math.min(e-1,Math.floor(t*e));a[n][i]++})}),a.map(function(t){return t.map(function(t){return t/i})})},elementFromHistograms:function(t){return E.elementFromHistograms(t,this.problem,this.random)},"static elementFromHistograms":function(t,e,n){for(var i,a,r=t.length,o=new Array(r),s=0;s<r;++s){i=t[s],a=n.random();for(var u=0;u<=i.length;++u)if(u===i.length||(a-=i[u])<=0){o[s]=Math.min(1,Math.max(0,(u+n.random())/i.length));break}}return new e.Element(o)},"static histogramProblem":function(t,n,r){n=isNaN(n)?30:Math.max(1,0|n),r=isNaN(r)?10:Math.max(2,0|r);t.elementLength();var o=this.elementFromHistograms;return HistogramProblem=i(y,{elementLength:function t(){return t*r},evaluation:function(i){var r=this.mapping(i),s=e.Iterable.repeat(null,n).map(function(){return o(r,t,t.random)});return l.all(a(s).map(function(t){return l.when(t.evaluate())})).then(function(t){return a(t).sum()/t.length})},mapping:function(t){for(var e,n,i=[],o=0;o<t.length;++o)e=t.values().slice(o*r,(o+1)*r),n=a(e).sum(),i[o]=e.map(function(t){return t/n});return i},compare:t.compare}),new HistogramProblem({random:t.random})},"static __SERMAT__":{identifier:"DistributionEstimation",serializer:function(t){return[t.__params__("histogramWidth")]}}}));_.GradientDescent=i(N,{constructor:function(t){N.call(this,t),r(this,t).number("delta",{coerce:!0,defaultValue:1}).integer("size",{coerce:!0,defaultValue:1,minimum:1})},gradient:function(t){return this.gradientFiniteDifferences(t)},rate:function(t){return t=isNaN(t)?this.step:0|t,1/Math.max(1,t)},estimatorWidth:function(t,e){return t=isNaN(t)?this.step:0|t,e=isNaN(e)?this.delta:+e,Math.pow(Math.max(1,t),-1/3)*e},update:function(){var t=this,e=this.rate(this.step);return l.all(this.state.map(function(n){var i=n.model;return l.then(t.gradient(n),function(a){var r=a.map(function(t,a){return g(n.__values__[a]-t*e,0,i[a].n-1)});return new t.problem.Element(r)})})).then(function(e){return t.evaluate(e)}).then(function(e){return t.state=e,t.onUpdate(),t})},gradientFiniteDifferences:function(t,e){e=isNaN(e)?this.estimatorWidth():+e;var n=this,i=t.values();return l.all(i.map(function(i,a){var r=t.modification(a,i-e),o=t.modification(a,i+e);return l.then(r.evaluate(),function(t){return l.then(o.evaluate(),function(i){var a=n.problem.compare(r,o);return a=0===a?a:a>0?1:-1,(t[0]-i[0])*a/2/e})})}))},gradientSimultaneousPerturbation:function(t,e){throw new Error("GradientDescent.gradientSimultaneousPerturbation() is not implemented!")},"static __SERMAT__":{identifier:"GradientDescent",serializer:function(t){return[t.__params__("delta")]}}});d.HelloWorld=i(y,{title:"Hello world",description:"Simple problem where each element is a string, and the optimization goes towards the target string.",constructor:function(t){r(this,t=t||{}).string("target",{coerce:!0,defaultValue:"Hello world!"}),y.call(this,Object.assign(t,{objective:-1/0,elementModel:c.repeat({n:95},this.target.length).toArray()})),this.__target__=a(this.target).map(function(t){return t.charCodeAt(0)}).toArray()},mapping:function(t){return t.values().map(function(t){return String.fromCharCode(t+32)}).join("")},evaluation:function(t){return t.manhattanDistance(this.__target__,t.rangeMapping([32,127]))},sufficientElement:function(t){return this.mapping(t)===this.target},"static __SERMAT__":{identifier:"HelloWorld",serializer:function(t){return[t.__params__("target")]}}});var w=d.TestBed=i(y,{constructor:function(t){var n=isNaN(t.minimumValue)?-1e6:+t.minimumValue,i=isNaN(t.maximumValue)?1e6:+t.maximumValue,a=isNaN(t.length)?2:+t.length;y.call(this,e.copy({title:t.title,elementModel:c.repeat({n:2e6},a).toArray()},t)),this.evaluation=function(e){return t.evaluation(e.rangeMapping([n,i]))},t.hasOwnProperty("optimumValue")&&(this.sufficientElement=function(e){return Math.abs(e.evaluation-t.optimumValue)<e.resolution})}});d.testbeds={Ackley:function(t,e,n,i){return e=isNaN(e)?20:+e,n=isNaN(n)?.2:+n,i=isNaN(i)?2*Math.PI:+i,new w({title:"Ackley testbed",length:t,objectives:-1/0,minimumValue:-32.768,maximumValue:32.768,optimumValue:0,evaluation:function(t){for(var a,r=0,o=0,s=t.length,u=0;u<s;++u)r+=(a=t[u])*a,o+=Math.cos(i*a);return-e*Math.exp(-n*Math.sqrt(r/s))-Math.exp(o/s)+e+Math.exp(1)}})},crossInTray:function(t){return t=isNaN(t)?-1/0:+t,new w({title:"cross-in-tray testbed",length:2,objectives:t,minimumValue:-10,maximumValue:10,evaluation:function(t){var e=t[0],n=t[1];return-1e-4*Math.pow(Math.abs(Math.sin(e)*Math.sin(n)*Math.exp(Math.abs(100-Math.sqrt(e*e+n*n)/Math.PI)))+1,.1)}})},Griewank:function(t){return new w({title:"Griewank testbed",length:t,minimumValue:-600,maximumValue:600,optimumValue:0,evaluation:function(t){for(var e,n=0,i=1,a=t.length,r=0;r<a;++r)n+=(e=t[r])*e/4e3,i*=Math.cos(e/Math.sqrt(r+1));return n-i+1}})},Levy:function(t){return new w({title:"Levy testbed",length:t,objectives:-1/0,minimumValue:-10,maximumValue:10,optimumValue:0,evaluation:function(t){for(var e,n=0,i=t.length,a=1+(t[0]-1)/4,r=1+(t[i-1]-1)/4,o=1;o<i-1;++o)e=1+(t[o]-1)/4,n+=Math.pow(e-1,2)*(1+10*Math.pow(Math.sin(Math.PI*e+1),2));return Math.pow(Math.sin(Math.PI*a),2)+n+Math.pow(r-1,2)*(1+Math.pow(Math.sin(2*Math.PI*r),2))}})},Michalewicz:function(t,e){return e=isNaN(e)?10:+e,new w({title:"Michalewicz testbed",length:t,objectives:-1/0,minimumValue:0,maximumValue:Math.PI,evaluation:function(t){for(var n,i=0,a=t.length,r=0;r<a;++r)n=t[r],i+=Math.sin(n)*Math.pow(Math.sin((r+1)*n*n/Math.PI),2*e);return-i}})},perm0:function(t,e){return t=isNaN(t)?2:Math.min(1,0|t),e=isNaN(e)?0:+e,new w({title:"Perm(0,"+t+","+e+") testbed",length:t,objectives:-1/0,minimumValue:-t,maximumValue:+t,optimumValue:0,evaluation:function(n){for(var i,a=0,r=0;r<t;++r){i=0;for(var o=0;o<t;++o)i+=(o+1+e)*(Math.pow(n[o],r+1)-Math.pow(1/(o+1),r+1));a+=i*i}return a}})},Rastrigin:function(t){return new w({title:"Rastrigin testbed",length:t,objectives:-1/0,minimumValue:-5.12,maximumValue:5.12,optimumValue:0,evaluation:function(t){for(var e,n=0,i=t.length,a=0;a<i;++a)n+=(e=t[a])*e-10*Math.cos(2*Math.PI*e);return 10*i+n}})},Rosenbrock:function(t,e,n){return e=isNaN(e)?1:+e,n=isNaN(n)?100:+n,new w({title:"Rosenbrock testbed",length:t,objectives:-1/0,optimumValue:0,evaluation:function(t){for(var i=0,a=1;a<t.length;++a)i+=n*Math.pow(t[a-1]*t[a-1]-t[a],2)+Math.pow(t[a-1]-e,2);return i}})},Schwefel:function(t){return new w({title:"Schwefel testbed",length:t,objectives:-1/0,minimumValue:-500,maximumValue:500,optimumValue:0,evaluation:function(t){for(var e,n=0,i=t.length,a=0;a<i;++a)n+=(e=t[a])*Math.sin(Math.sqrt(Math.abs(e)));return 418.9829*i-n}})},sphere:function(t){return new w({title:"sphere testbed",length:t,objectives:-1/0,optimumValue:0,evaluation:function(t){for(var e=0,n=0;n<t.length;++n)e+=t[n]*t[n];return e}})},sumOptimization:function(t,e){return t=isNaN(t)?2:Math.max(1,0|t),e=isNaN(e)?-1/0:+e,new w({title:"sum optimization testbed",length:t,objectives:e,minimumValue:0,maximumValue:1,optimumValue:e===-1/0?0:e===1/0?t:e,evaluation:function(t){return a(t).sum()}})},ZDT1:function(t){return t=isNaN(t)?30:Math.max(1,0|t),new w({title:"Zitzler-Deb-Thiele function 1",length:t,objectives:[-1/0,-1/0],minimumValue:0,maximumValue:1,evaluation:function(t){var e=t[0],n=a(t).tail().sum()/(t.length-1)*9;return[e,n*(1-Math.sqrt(e/n))]}})},ZDT2:function(t){return t=isNaN(t)?30:Math.max(1,0|t),new w({title:"Zitzler-Deb-Thiele function 2",length:t,objectives:[-1/0,-1/0],minimumValue:0,maximumValue:1,evaluation:function(t){var e=t[0],n=a(t).tail().sum()/(t.length-1)*9;return[e,n*(1-Math.pow(e/n,2))]}})},ZDT3:function(t){return t=isNaN(t)?30:Math.max(1,0|t),new w({title:"Zitzler-Deb-Thiele function 3",length:t,objectives:[-1/0,-1/0],minimumValue:0,maximumValue:1,evaluation:function(t){var e=t[0],n=a(t).tail().sum()/(t.length-1)*9;return[e,n*(1-Math.sqrt(e/n)-e/n*Math.sin(10*Math.PI*e))]}})}},d.NQueensPuzzle=i(y,{title:"N-queens puzzle",description:"Generalized version of the classic problem of placing 8 chess queens on an 8x8 chessboard so that no two queens attack each other.",constructor:function(t){t=Object.assign({N:8},t),y.call(this,t=Object.assign(t,{objective:-1/0,elementModel:c.repeat({n:t.N},t.N-1).toArray()})),r(this,t).integer("N",{coerce:!0,defaultValue:8}),this.__rowRange__=c.range(this.N).toArray()},mapping:function(t){return t.setMapping(this.__rowRange__)},evaluation:function(t){var e=this.mapping(t),n=0;return e.forEach(function(t,i){for(var a=1;i+a<e.length;a++)e[a]!=t+a&&e[a]!=t-a||n++}),n},sufficientElement:function(t){return 0===t.evaluation},"static __SERMAT__":{identifier:"NQueensPuzzle",serializer:function(t){return[t.__params__("N")]}}}),d.KnapsackProblem=i(y,{title:"Knapsack problem",description:"Given a set of items with a cost and a worth, select a subset  maximizing the worth sum but not exceeding a cost limit.",items:{itemA:{cost:12,worth:4},itemB:{cost:2,worth:2},itemC:{cost:1,worth:2},itemD:{cost:1,worth:1},itemE:{cost:4,worth:10}},constructor:function(t){t=t||{};var e=this.items;this.__elementItems__=Object.keys(e),this.__elementItems__.sort(),y.call(this,t=Object.assign(t,{objective:1/0,elementModel:this.__elementItems__.map(function(t){return{n:+(e[t].amount||1)+1}})})),r(this,t).number("limit",{coerce:!0,defaultValue:15}).integer("amount",{coerce:!0,defaultValue:1,minimum:1}).object("items",{ignore:!0})},mapping:function(t){return a(this.__elementItems__).zip(t.values()).toObject()},evaluation:function(t){var e=this.mapping(t),n=this.items,i=0,r=0;return a(e).forEachApply(function(t,e){var a=n[t];i+=a.worth*e,r+=a.cost*e}),r>problem.limit?-i:i},"static __SERMAT__":{identifier:"KnapsackProblem",serializer:function(t){return[t.__params__("limit","amount","items")]}}});d.AssociationRuleLearning=i(y,{constructor:function(t){r(this,t).object("dataset",{defaultValue:[]}).array("keys"),y.call(this,e.copy({elementModel:c.repeat({n:3},this.keys.length).toArray()},t))},mapping:function(t){var e=this,n=[],i=[];return t.__values__.forEach(function(t,a){switch(t){case 1:n.push(e.keys[a]);break;case 2:i.push(e.keys[a])}}),{antecedent:n,consequent:i}},keysComply:function(t,e){var n=a(t);return!n.isEmpty()&&n.all(function(t){return!!e[t]})},antecedentComplies:function(t,e){return this.keysComply(t.antecedent,e)},consequentComplies:function(t,e){return this.keysComply(t.consequent,e)},measures:function(t){var e=this,n={},i=0,r=0,o=0,s=0,u=this.mapping(t);return a(this.dataset).forEach(function(t){e.antecedentComplies(u,t)?(++r,e.consequentComplies(u,t)&&(++o,++s)):e.consequentComplies(u,t)&&++o,++i}),n.antecedentCount=r,n.consequentCount=o,n.ruleCount=s,n.antecedentSupport=i>0?r/i:0,n.consequentSupport=i>0?o/i:0,n.ruleSupport=i>0?s/i:0,n.confidence=r>0?s/r:0,n.lift=n.consequentSupport>0?n.confidence/n.consequentSupport:0,n.conviction=n.consequentSupport>0&&n.confidence<1?(1-n.consequentSupport)/(1-n.confidence):0,n.leverage=n.ruleSupport-n.antecedentSupport*n.consequentSupport,n},evaluation:function(t){return t.__measures__||(t.__measures__=this.measures(t)),t.__measures__.confidence}});return[M,y,N].forEach(function(t){t.__SERMAT__.identifier=p.__package__+"."+t.__SERMAT__.identifier,p.__SERMAT__.include.push(t)}),n.include(p),p});
//# sourceMappingURL=inveniemus.min.js.map