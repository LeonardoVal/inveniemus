//! inveniemus 0.1.2

"use strict";!function(a,b){"function"==typeof define&&define.amd?define(["creatartis-base"],b):"object"==typeof module&&module.exports?module.exports=b(require("creatartis-base")):a.inveniemus=b(a.base)}(this,function a(b){var c=b.declare,d=b.initialize,e=b.iterable,f=b.raiseIf,g=b.Events,h=b.Future,j=b.Iterable,k=b.Logger,l=b.Randomness,m=b.Statistics,n={__name__:"inveniemus",__init__:a};a.dependencies={"creatartis-base":b};var o=n.Element=c({constructor:function(a,b){this.values="undefined"==typeof a?this.randomValues():a.slice(),this.evaluation=+b},length:10,minimumValue:0,maximumValue:1,random:l.DEFAULT,randomValue:function(){return this.random.random(this.minimumValue,this.maximumValue)},randomValues:function(){for(var a=new Array(this.length),b=this.minimumValue,c=this.maximumValue-this.minimumValue,d=0;d<this.length;d++)a[d]=this.random.random()*c+b;return a},evaluate:function(){return this.evaluation=e(this.values).sum()},suffices:function(){return 0===e(this.values).sum()},mapping:function(){return this.values},emblem:function(){return JSON.stringify(this.mapping())},resolution:1/Math.pow(2,52),hammingDistance:function(a,b){return e(a).zip(b).filter(function(a){return a[0]!=a[1]}).count()},manhattanDistance:function(a,b){return e(a).zip(b).map(function(a){return Math.abs(a[0]-a[1])}).sum()},euclideanDistance:function(a,b){return Math.sqrt(e(a).zip(b).map(function(a){return Math.pow(a[0]-a[1],2)}).sum())},rootMeanSquaredError:function(a,b){var c=0,d=e(b).map(function(b){return c++,Math.pow(b[0]-a.apply(this,b.slice(1)),2)}).sum();return 0==c?0:Math.sqrt(d/c)},successors:function(){return this.neighbourhood()},neighbourhood:function(a){a=isNaN(a)?(this.maximumValue-this.minimumValue)/100:+a;var b,c,d=[],e=this.values;for(b=0;b<e.length;b++)c=e[b]+a,c<=this.maximumValue&&d.push(this.modification(b,c)),c=e[b]-a,c>=this.minimumValue&&d.push(this.modification(b,c));return d},modification:function(){var a,b,c=new this.constructor(this.values);for(a=0;a<arguments.length;a+=2)b=+arguments[a+1],f(isNaN(b)||b<this.minimumValue||b>this.maximumValue,"Invalid value ",b," for element."),c.values[0|arguments[a]]=+arguments[a+1];return c},arrayMapping:function(){var a=arguments,b=a[a.length-1];return f(a.length<1,"Element.arrayMapping() expects at least one argument."),this.values.map(function(c,d){var e=a.length>d?a[d]:b;return e[c*e.length|0]})},setMapping:function(a){return f(!Array.isArray(a),"Element.setMapping() expects an array argument."),a=a.slice(),this.values.map(function(b){return a.splice(b*a.length|0,1)[0]})},clone:function(){return new this.constructor(this.values,this.evaluation)},equals:function(a){if(this.constructor===a.constructor&&this.values.length===a.values.length){for(var b=0,c=this.values.length;c>b;b++)if(this.values[b]!==a.values[b])return!1;return!0}return!1},toString:function(){return(this.constructor.name||"Element")+"("+JSON.stringify(this.values)+", "+this.evaluation+")"}}),p=n.Problem=c({title:"<no title>",description:"<no description>",random:l.DEFAULT,constructor:function(a){d(this,a).string("title",{coerce:!0,ignore:!0}).string("description",{coerce:!0,ignore:!0}).object("random",{ignore:!0}).func("representation",{ignore:!0}).func("compare",{ignore:!0}).func("suffices",{ignore:!0})},representation:o,compare:function(a,b){return this.minimization(a,b)},suffices:function(a){return a[0].suffices()},maximization:function(a,b){var c=b.evaluation-a.evaluation;return isNaN(c)?-1/0:Math.abs(c)<a.resolution?0:c},minimization:function(a,b){var c=a.evaluation-b.evaluation;return isNaN(c)?1/0:Math.abs(c)<a.resolution?0:c},approximation:function(a,b,c){var d=Math.abs(b.evaluation-a)-Math.abs(c.evaluation-a);return isNaN(d)?1/0:Math.abs(d)<b.resolution?0:d},toString:function(){return(this.constructor.name||"Problem")+"("+JSON.stringify(this)+")"}}),q=n.problems={},r=n.Metaheuristic=c({logger:new k("inveniemus",k.ROOT,"INFO"),constructor:function(a){d(this,a).object("problem",{defaultValue:null}).number("size",{defaultValue:100,coerce:!0}).array("state",{defaultValue:[]}).number("steps",{defaultValue:100,coerce:!0}).integer("step",{defaultValue:-1,coerce:!0}).object("random",{defaultValue:l.DEFAULT}).object("statistics",{defaultValue:new m}).object("logger",{ignore:!0}),this.events=new g({events:["initiated","updated","expanded","evaluated","sieved","advanced","analyzed","finished"]})},initiate:function(a){a=isNaN(a)?this.size:+a>>0,this.state=new Array(a);for(var b=0;a>b;b++)this.state[b]=new this.problem.representation;this.events.emit("initiated",this),this.logger&&this.logger.debug("State has been initiated. Nos coepimus.")},update:function(){var a=this;return this.expand(),this.evaluate().then(function(){return a.sieve(),a.events.emit("updated",this),a})},expand:function(a){if(a=a||this.expansion(),a.length<1)this.logger&&this.logger.warn("Expansion is empty");else{var b=this.state.concat(a),c=b.length;b=b.filter(function(a,d){for(d++;c>d;d++)if(a.equals(b[d]))return!1;return!0}),this.state=b}this.events.emit("expanded",this),this.logger&&this.logger.debug("State has been expanded. Nos exploramus.")},expansion:function(a){var b=isNaN(this.expansionRate)?.5:+this.expansionRate;a=isNaN(a)?Math.floor(b*this.size):+a;var c,d=new Array(a);for(c=0;a>c;c++)d[c]=new this.problem.representation;return d},evaluate:function(a){var b=this,c=this.statistics.stat({key:"evaluation_time"});return c.startTime(),a=a||this.state,h.all(e(a).filter(function(a){return isNaN(a.evaluation)},function(a){return h.when(a.evaluate())})).then(function(d){return a.sort(b.problem.compare.bind(b.problem)),c.addTime(),b.events.emit("evaluated",this),b.logger&&b.logger.debug("Evaluated and sorted ",d.length," elements. Appretiatus sunt."),a})},sieve:function(a){a=isNaN(a)?this.size:0|a,this.state.length>a&&(this.state=this.state.slice(0,this.size)),this.events.emit("sieved",this),this.logger&&this.logger.debug("State has been sieved. Viam selectus est.")},finished:function(){return this.step>=this.steps||this.problem.suffices(this.state)?(this.events.emit("finished",this),!0):!1},analyze:function(){var a=this.statistics.stat({key:"evaluation",step:this.step});return this.state.forEach(function(b){a.add(b.evaluation,b)}),this.events.emit("analyzed",this),a},advance:function(){var a,b=this,c=this.statistics.stat({key:"step_time"});return isNaN(this.step)||+this.step<0?(this.statistics.reset(),c.startTime(),this.initiate(),a=this.evaluate()):(c.startTime(),a=this.update()),a.then(function(){return b.step=isNaN(b.step)||+b.step<0?0:+b.step+1,b.analyze(),c.addTime(),b.events.emit("advanced",this),b.logger&&b.logger.info("Step ",b.step," has been completed. Nos proficimus."),b})},run:function(){function a(){return!b.finished()}var b=this,c=this.advance.bind(this);return h.doWhile(c,a).then(function(){return b.logger&&b.logger.info("Finished. Nos invenerunt!"),b.state[0]})},reset:function(){this.step=-1,this.statistics.reset()},toString:function(){return(this.constructor.name||"Metaheuristic")+"("+JSON.stringify(this)+")"}}),s=n.metaheuristics={},t=(s.HillClimbing=c(r,{constructor:function(a){r.call(this,a),d(this,a).number("delta",{defaultValue:.01,coerce:!0}).integer("size",{defaultValue:1,coerce:!0})},update:function(){var a=this,b=0;return h.all(this.state.map(function(c){var d=c.neighbourhood(a.delta);return d.push(c),a.evaluate(d).then(function(a){var d=a[0];return c===d&&b++,d})})).then(function(c){a.state=c,a.__localOptima__=b})},atLocalOptima:function(){return this.__localOptima__>=this.state.length},finished:function(){return r.prototype.finished.call(this)||this.atLocalOptima()},toString:function(){return(this.constructor.name||"HillClimbing")+"("+JSON.stringify(this)+")"}}),s.GeneticAlgorithm=c(r,{constructor:function u(a){r.call(this,a),d(this,a).number("expansionRate",{defaultValue:.5,minimum:0,coerce:!0}).number("mutationRate",{defaultValue:.2,minimum:0,maximum:1,coerce:!0}).func("selection",{defaultValue:u.selections.rankSelection}).func("crossover",{defaultValue:u.crossovers.singlepointCrossover}).func("mutation",{defaultValue:u.mutations.singlepointUniformMutation})},expansion:function(){var a,b,c,d=[],e=Math.floor(this.expansionRate*this.size);e+=e%2;for(var f=0;e>f;f+=2){a=this.selection(),b=this.crossover(a);for(var g=0;g<b.length;g++)c=this.random.randomBool(this.mutationRate)?this.mutation(b[g]):b[g],d.push(c)}return d},toString:function(){return(this.constructor.name||"GeneticAlgorithm")+"("+JSON.stringify(this)+")"}}));t.selections={rankSelection:function(a){a=isNaN(a)?2:+a;var b=this.state.length,c=this.random.randoms(a,0,b*(b+1)/2-1),d=[];return c.sort(function(a,b){return a-b}),this.state.forEach(function(e){for(var f=0;a>f;f++)c[f]+=f-b;c[0]<=0&&(d.push(e),c.shift())}),d.length<a&&(d=d.concat(this.state.slice(0,a-d.length))),d},rouletteSelection:function(a){a=isNaN(a)?2:+a;var b=this.state.length,c=this.statistics.stat({key:"evaluation",step:this.step}),d=c.minimum(),e=c.sum(),f=this.random.randoms(a,0,e-b*d),g=[];return f.sort(function(a,b){return a-b}),this.state.forEach(function(c){for(var d=0;a>d;d++)f[d]+=d-b;f[0]<=0&&(g.push(c),f.shift())}),g.length<a&&(g=g.concat(this.state.slice(0,a-g.length))),g}},t.crossovers={singlepointCrossover:function(a){f(!Array.isArray(a)||a.length<2,"A two parent array is required.");var b=this.random.randomInt(this.length-1)+1,c=a[0].values,d=a[1].values,e=this.problem.representation;return[new e(c.slice(0,b).concat(d.slice(b))),new e(d.slice(0,b).concat(c.slice(b)))]}},t.mutations={singlepointUniformMutation:function(a){return a.modification(this.random.randomInt(a.length),a.randomValue())},uniformMutation:function(a){return max=isNaN(a)?1/0:+a,function(b){var c=a;b=new b.constructor(b.values);do b.values[this.random.randomInt(b.length)]=b.randomValue();while(this.random.randomBool(this.mutationRate)&&--c>0);return b}},singlepointBiasedMutation:function(a){return a.modification(this.random.randomInt(a.length),Math.max(a.minimumValue,Math.min(a.maximumValue,a.values[i]+this.random.random()-this.random.random())))}};s.BeamSearch=c(r,{constructor:function(a){r.call(this,a)},successors:function(a){return a.successors()},expansion:function(){var a=[],b=this.successors.bind(this);return this.state.forEach(function(c){a=a.concat(b(c))}),a},toString:function(){return(this.constructor.name||"BeamSearch")+"("+JSON.stringify(this)+")"}}),s.SimulatedAnnealing=c(r,{constructor:function(a){r.call(this,a),d(this,a).number("maximumTemperature",{defaultValue:1,coerce:!0}).number("minimumTemperature",{defaultValue:0,coerce:!0}).number("delta",{defaultValue:.01,coerce:!0}).integer("size",{defaultValue:1,coerce:!0})},randomNeighbour:function(a,b){b=isNaN(b)?this.delta:+b;var c=this.random.randomInt(a.values.length),d=a.values[c];return d=this.random.randomBool()?Math.min(a.maximumValue,d+b):Math.max(a.minimumValue,d-b),a.modification(c,d)},acceptance:function(a,b,c){if(c=isNaN(c)?this.temperature():+c,this.problem.compare(a,b)>0)return 1;var d=-Math.abs(b.evaluation-a.evaluation);return Math.min(1,Math.exp(d/c))},temperature:function(){return(1-Math.max(0,this.step)/this.steps)*(this.maximumTemperature-this.minimumTemperature)+this.minimumTemperature},update:function(){var a=this,b=this.temperature(),c=this.statistics.stat({key:"acceptance"}),d=this.statistics.stat({key:"temperature"});return d.add(b,this.step),h.all(this.state.map(function(d){var e=a.randomNeighbour(d);return h.when(e.evaluate()).then(function(){var f=a.acceptance(d,e,b);return c.add(f,e),a.random.randomBool(f)?e:d})})).then(function(b){return a.state=b})},toString:function(){return(this.constructor.name||"SimulatedAnnealing")+"("+JSON.stringify(this)+")"}});return q.SumOptimization=c(p,{title:"Sum optimization",description:"Very simple problem based on optimizing the elements' values sum.",constructor:function(a){p.call(this,a),d(this,a).number("target",{coerce:!0,defaultValue:-1/0})},representation:c(o,{evaluate:function(){return this.evaluation=e(this.values).sum()}}),suffices:function(a){return e(a[0].values).sum()===this.target},compare:function(a,b){return this.target===-1/0?this.minimization(a,b):1/0===this.target?this.maximization(a,b):this.approximation(this.target,a,b)}}),q.HelloWorld=c(p,{title:"Hello world",description:"Simple problem where each element is a string, and the optimization goes towards the target string.",constructor:function(a){p.call(this,a),d(this,a).string("target",{coerce:!0,defaultValue:"Hello world!"});var b=this.target,f=e(b).map(function(a){return a.charCodeAt(0)}).toArray();this.representation=c(o,{length:b.length,minimumValue:32,maximumValue:254,suffices:function(){return this.mapping()===b},evaluate:function(){return this.evaluation=this.manhattanDistance(f,this.values)},mapping:function(){return e(this.values).map(function(a){return String.fromCharCode(0|a)}).join("")}})},compare:p.prototype.minimization}),q.NQueensPuzzle=c(p,{title:"N-queens puzzle",description:"Generalized version of the classic problem of placing 8 chess queens on an 8x8 chessboard so that no two queens attack each other.",constructor:function(a){p.call(this,a),d(this,a).integer("N",{coerce:!0,defaultValue:8});var b=j.range(this.N).toArray();this.representation=c(o,{length:this.N,suffices:function(){return 0===this.evaluation},evaluate:function(){var a=this.mapping(),b=0;return a.forEach(function(c,d){for(var e=1;d+e<a.length;e++)(a[e]==c+e||a[e]==c-e)&&b++}),this.evaluation=b},mapping:function(){return this.setMapping(b)}})},compare:p.prototype.minimization}),q.KnapsackProblem=c(p,{title:"Knapsack problem",description:"Given a set of items with a cost and a worth, select a subset  maximizing the worth sum but not exceeding a cost limit.",items:{itemA:{cost:12,worth:4},itemB:{cost:2,worth:2},itemC:{cost:1,worth:2},itemD:{cost:1,worth:1},itemE:{cost:4,worth:10}},constructor:function(a){p.call(this,a),d(this,a).number("limit",{coerce:!0,defaultValue:15}).integer("amount",{coerce:!0,defaultValue:1,minimum:1}).object("items",{ignore:!0});var b=this;this.representation=c(o,{length:Object.keys(this.items).length,evaluate:function(){var a=this.mapping(),c=0,d=0;return Object.keys(a).forEach(function(e){var f=b.items[e],g=a[e];c+=f.worth*g,d+=f.cost*g}),this.evaluation=d>b.limit?-c:c},mapping:function(){var a={},c=Object.keys(b.items);return c.sort(),e(this.values).zip(c).forEach(function(c){var d=b.items[c[1]],e=c[0]*(1+(+d.amount||1))|0;a[c[1]]=e}),a}})},compare:p.prototype.maximization}),n});
//# sourceMappingURL=inveniemus.min.js.map